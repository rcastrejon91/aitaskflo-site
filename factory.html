<script>
  const BASE_URL = "https://workspace.ricardomcastrej.replit.dev"; 
  // üëÜ this points to your live Replit backend

  async function runBot(botName) {
    const logBox = document.getElementById("logs");
    logBox.innerHTML += `[Orchestrator] Dispatching task ‚Üí ${botName}\n`;

    try {
      const res = await fetch(`${BASE_URL}/run-bot`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ botName, input: "Test input from Factory" })
      });

      const data = await res.json();
      for (const line of data.logs) {
        await typeLine(logBox, line, botName);
      }
    } catch {
      logBox.innerHTML += `[System] ‚ùå Error running ${botName}\n`;
    }
  }

  async function runTeamBot() {
    const input = document.getElementById("teamInput").value;
    const outputBox = document.getElementById("teamOutput");
    outputBox.innerHTML = "üßë‚Äçü§ù‚Äçüßë Crew is discussing...\n";

    try {
      const res = await fetch(`${BASE_URL}/team-run`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ input })
      });
      const data = await res.json();

      for (const line of data.logs) {
        let botName = "";
        if (line.toLowerCase().includes("emailbot")) botName = "emailBot";
        if (line.toLowerCase().includes("taskbot")) botName = "taskBot";
        if (line.toLowerCase().includes("analyticsbot")) botName = "analyticsBot";
        if (line.toLowerCase().includes("researchbot")) botName = "researchBot";

        await typeLine(outputBox, line, botName);
      }
    } catch {
      outputBox.innerHTML += "‚ùå Error connecting to the crew.\n";
    }
  }

  async function typeLine(box, text, botName="") {
    let avatar = botName 
      ? `<span class="bot-avatar ${botName}"></span>` 
      : "";

    box.innerHTML += avatar;
    for (let i = 0; i < text.length; i++) {
      box.innerHTML += text[i];
      box.scrollTop = box.scrollHeight;
      await new Promise(r => setTimeout(r, 20));
    }
    box.innerHTML += "\n";
  }
</script>